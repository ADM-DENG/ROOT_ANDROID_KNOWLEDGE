 * **AB 卡槽的影响：**

   * Android 设备中的 A/B 分区（双卡槽）使得系统能够在一个卡槽更新时，另一个卡槽仍然保持正常运行。这在刷机和系统更新中起到了关键作用。
   * 当你刷入 `init_boot_a`（LKM 模块）时，实际上只是在 **A 卡槽** 上进行修改，而 **B 卡槽** 可能仍然使用原始的内核。你需要确保在两者都能支持 GKI，或者在后期切换到 GKI 内核时，同时对 A 和 B 卡槽进行刷机操作。


* **只刷入 `init_boot_a`（LKM）** 后期仍然可以进行 GKI 转换，但需要注意的几个点：

  * `init_boot_a` 只是暂时解决驱动和模块的问题，并没有全面转换到 GKI 内核。
  * 在切换到 GKI 时，你必须确保同时对 **A** 和 **B** 卡槽的 `boot` 和 `init_boot` 分区进行刷机操作。
  * 刷入 GKI 内核后，可能需要配合 LKM 模块来确保硬件驱动的兼容性。
  * 无论是boot.img还是init_boot.img修补后刷入工作模式都是LKM。只有将kernelsu或者magiskboot打包进入内核压缩包，刷入系统，才是GKI工作模式。
  * 需要处理好 **AVB 验证**，避免启动失败。

---
* **以安卓/一加卡刷包为例，各包的作用：**

### **重要文件：**

1. **`boot.img`** (大小：67MB)

   * **功能**：包含系统启动所需的 **内核** 和 **ramdisk**。是启动系统的核心文件。

2. **`vbmeta.img`** (大小：8KB)

   * **功能**：包含 **AVB（Android Verified Boot）** 的信息，用来验证系统的完整性。关闭 AVB 时会刷入修改后的 vbmeta 文件。

3. **`system.img`** (大小：~~816MB~~)

   * **功能**：包含 Android 系统的核心部分，包含了大部分应用和系统文件。

4. **`vendor.img`** (大小：~~1.2GB~~)

   * **功能**：包含了与硬件相关的文件和驱动，通常由设备厂商提供。安卓的 Vendor 目录存放着设备厂商的定制化软件和驱动。

5. **`recovery.img`** (通常是 `boot.img` 的变种)

   * **功能**：Android 恢复模式的镜像文件，提供设备恢复和刷机的功能。

6. **`preloader_raw.img`** (大小：1.9MB)

   * **功能**：是 **联发科（MTK）** 设备的 **预加载** 程序，启动时会执行一些必要的硬件初始化。

7. **`vendor_boot.img`** (大小：64MB)

   * **功能**：包含设备的 **Vendor 相关启动镜像**，和 **boot.img** 一样用于启动，但是它只在设备的 **Vendor 部分**加载。

8. **`dtbo.img`** (大小：1.1MB)

   * **功能**：设备树（Device Tree Blob）文件，它定义了设备的硬件架构和驱动。

9. **`modem.img`** (大小：71MB)

   * **功能**：包含设备的 **基带固件（modem）**，它支持设备与蜂窝网络（如4G/5G）之间的通信。

10. **`init_boot.img`** (大小：8MB)

    * **功能**：类似于 boot.img，但是它包含设备初始化所需的启动参数。

### **其他文件：**

1. **`cdt_engineering.img`** (大小：1MB)

   * **功能**：可能是用于工程模式的固件。

2. **`audio_dsp.img`** (大小：12MB)

   * **功能**：音频数字信号处理器（DSP）固件，负责处理音频信号。

3. **`mcf_ota.img`** (大小：32MB)

   * **功能**：OTA 更新相关文件，通常用于设备的 **过渡更新**。

4. **`scp.img`** (大小：8MB)

   * **功能**：可能是 **安全控制处理器（SCP）** 的固件，用于加密、身份验证等任务。

5. **`tee.img`** (大小：1.6MB)

   * **功能**：TEE（受信执行环境）固件，涉及硬件级安全操作。

6. **`vcp.img`** (大小：2MB)

   * **功能**：可能是 **视频编解码器** 或图形处理相关的固件。

7. **`odm.img`** (大小：~~1.5GB~~)

   * **功能**：包含设备特有的定制化文件（比如某些硬件的驱动），是 **厂商（ODM）** 提供的文件。

8. **`system_dlkm.img`** (大小：7MB)

   * **功能**：通常包含系统的 **动态加载内核模块（Dynamic Loadable Kernel Module）**。

9. **`product.img`** (大小：~~1.1GB~~)

   * **功能**：和 `system.img` 类似，但主要包含应用和系统功能的定制文件。

10. **`spmfw.img`** (大小：36KB)

    * **功能**：可能是 **系统功率管理固件（SPM）**，用于电池和电源管理。

### **其他小文件：**

* **`my_carrier.img`** / **`my_engineering.img`** / **`my_heytap.img`** 等（大小：约 335KB）

  * **功能**：这些通常是与 **运营商定制** 或 **工程功能** 相关的镜像文件。

* **`gz.img`** (大小：3.7MB)

  * **功能**：可能是系统的压缩文件（GZIP）格式。

* **`vcp.img`** 和 **`ccu.img`** 等（小于 10MB）

  * **功能**：这些小文件通常是与硬件驱动、固件加载等系统功能相关。

---

### **总结：**

* **核心系统文件**：`boot.img`, `system.img`, `vendor.img`, `vbmeta.img`。
* **硬件驱动及初始化文件**：`modem.img`, `dtbo.img`, `preloader_raw.img`。
* **安全与恢复相关文件**：`recovery.img`, `tee.img`, `scp.img`。
* **定制与OTA更新文件**：`mcf_ota.img`, `product.img`, `odm.img`。

大多数文件都是为了设备的硬件、启动、系统和安全功能而设计的。通过 **vbmeta.img** 关闭 **AVB**，可以绕过系统验证，这在刷机时非常常见。

---


### **查看当前处于哪个槽位**

```bash
fastboot getvar current-slot
```

输出一般是：

```
current-slot: a
```
* 切换到 **B 槽**：

```bash
fastboot set_active b
```
**指定槽刷入**（例子：boot 分区）：

   ```bash
   fastboot flash boot_a boot.img
   fastboot flash boot_b boot.img
   ```

   这样保证 A、B 两个槽位都刷上了同一个 boot.img。

**只刷当前活动槽**（风险大，另一槽可能启动失败）：

   ```bash
   fastboot flash boot boot.img
   ```

### **实战建议**

* 做实验 / 刷不稳定内核时，可以 **只刷当前槽**，万一起不来还可以切回另一槽救机。
* 确认要长期使用的版本时，最好 **A、B 两个槽都刷一致**，避免 OTA 更新时切换槽后启动失败。


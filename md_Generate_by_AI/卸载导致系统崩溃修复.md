

---

# 📒 安卓系统应用冻结/卸载导致系统崩溃修复笔记

## 前言

在使用 **小黑屋**、**第三方冻结工具**、**MT 管理器**、**ADB** 等方式禁用/卸载系统应用时，可能导致系统无法正常启动。本笔记梳理风险等级与修复方法。

* **一级警告（严禁卸载）**：

  * 安卓原生框架核心包，无明显第三方特征。
  * eg：`com.android.installer`、`com.android.providers.downloads`
* **二级警告（强烈不建议卸载）**：

  * 系统定制商预装的核心功能包（部分可以卸载，但可能影响稳定性）。
  * eg：`com.coloros.codebook`

---

## 系统崩溃的两类情况

### **情况一：禁用系统应用（未删除 APK）**

* 操作仅修改 `/data/system/packages.xml` 与 `/data/system/users/0/package-restrictions.xml`。
* APK 文件仍在 `/system` 分区，不涉及底层破坏。

**修复难点**：

* 新设备采用 **A/B 动态分区**，无独立 recovery。
* 官方 recovery 功能弱，仅支持清除数据/OTA，不提供分区挂载与 ADB shell。
* 无第三方 recovery（TWRP 等）时，无法直接挂载 `/system` 或 `/data`。

**可行修复方案**：

1. **清空 `/data`（最简单）**

   ```bash
   fastboot -w
   ```

   * 所有系统应用恢复默认启用。
   * 缺点：用户数据清除。

2. **临时修复 boot.img（进阶）**

   * 制作/下载一个修改过的 `boot.img`，在 init 脚本中加入：

     ```bash
     pm enable com.android.packageinstaller
     ```

     或直接修改 `packages.xml`。
   * 通过 fastboot 临时引导：

     ```bash
     fastboot boot patched_boot.img
     ```
   * 开机后自动修复，无需清空数据。

3. **解包并修改 `/data` 镜像（硬核）**

   * 在 PC 上解包 `userdata.img` 或 dump 出分区 → 挂载修改 XML → 再回刷。
   * 操作复杂，失败风险大。

---

### **情况二：删除/卸载系统应用（APK 文件缺失）**

* 通过 MT 管理器或 ADB 直接删除 `/system` 分区中的 APK。
* 破坏只读分区内容，已无法通过“启用”修复。

**修复难点**：

* APK 文件缺失，必须依赖完整的 ROM 分区镜像。
* system/vendor/product/system\_ext 都可能互相依赖。
* Android 10+：system/vendor/product/system_ext/odm 由 super 分区统一管理。fastboot 中只能看到一个 super 分区。
* 👉 无需写 `_a`/`_b`，动态分区共享，A/B 冗余只针对 boot/init\_boot/vendor\_boot/vbmeta 等。



**修复步骤**：

1. **解包官方 ROM** → 得到 `system.img`、`vendor.img`、`product.img`、`system_ext.img` 等。
2. **进入 fastbootd 模式**：

   ```bash
   fastboot reboot fastboot
   ```
3. **最小修复（只刷 system.img）**：

   ```bash
   fastboot flash system system.img
   ```
4. **扩展修复（推荐）**：

   ```bash
   fastboot flash vendor vendor.img
   fastboot flash product product.img
   fastboot flash system_ext system_ext.img
   fastboot flash odm odm.img
   ```
5. **处理 vbmeta 校验（若机型强制 AVB 校验）**：

   ```bash
   fastboot --disable-verity --disable-verification flash vbmeta vbmeta.img
   ```
6. **重启**：

   ```bash
   fastboot reboot
   ```

**总结**：

* **禁用 → 修复 `/data` 即可**。
* **删除 → 必须刷回对应分区镜像**，否则缺失文件无法恢复。
* 正常情况下不需清除 `/data`，只要分区刷回，用户数据可保留。

---

## 📌 总结要点

* **禁用系统应用 → `/data` 层面修复**

  * 最简单：`fastboot -w`
  * 优雅：临时 boot.img 修复脚本
  * 硬核：修改 userdata 镜像
* **删除系统应用 → 分区文件缺失，必须刷回分区镜像**

  * 最小：刷 system.img
  * 稳定：全量 system/vendor/product/system\_ext
  * 可选：处理 vbmeta

---
